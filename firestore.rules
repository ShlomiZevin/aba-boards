rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Kids collection - existing rules
    match /kids/{kidId} {
      // Anyone can read kid data
      allow read: if true;

      // Anyone can update tasks and progress
      // Note: In a real production app, you'd want to add authentication
      allow write: if true;
    }

    // Kid Stats collection - for ABA instructor dashboard
    match /kidStats/{kidId} {
      // Anyone can read stats
      allow read: if true;

      // Anyone can write stats (updated from board.html when tasks are completed)
      // Note: In a real production app, you'd want to add authentication
      allow write: if true;
    }

    // Board Requests collection - for customer form submissions
    match /boardRequests/{requestId} {
      // Anyone can create a new board request (for the public form)
      allow create: if true;

      // Only allow reading all requests (for admin view)
      // In production, you should add authentication here
      allow read: if true;

      // Allow updates (for admin to change status, link boards, etc.)
      // In production, you should add authentication here
      allow update: if true;

      // Prevent deletion for safety
      allow delete: if false;
    }

    // Invite Tokens collection - for parent self-service links
    match /inviteTokens/{tokenId} {
      // Anyone can read tokens (to validate them)
      allow read: if true;

      // Anyone can create tokens (admin generates them)
      // In production, you should restrict this to authenticated admins
      allow create: if true;

      // Anyone can update tokens (to mark as used)
      // In production, you should add validation
      allow update: if true;

      // Prevent deletion for safety
      allow delete: if false;
    }

    // ==================== THERAPY CENTER COLLECTIONS ====================
    // Note: These are accessed via server-side Firebase Admin SDK
    // which bypasses these rules. Rules here for documentation/future use.

    // Practitioners collection (therapists + admins)
    match /practitioners/{practitionerId} {
      allow read, write: if true;
    }

    // Kid-Practitioner junction table
    match /kidPractitioners/{linkId} {
      allow read, write: if true;
    }

    // Parents collection
    match /parents/{parentId} {
      allow read, write: if true;
    }

    // Goal categories (pre-seeded)
    match /goalCategories/{categoryId} {
      allow read: if true;
      allow write: if true;
    }

    // Goals per kid
    match /goals/{goalId} {
      allow read, write: if true;
    }

    // Goals library (for autocomplete)
    match /goalsLibrary/{itemId} {
      allow read, write: if true;
    }

    // Sessions
    match /sessions/{sessionId} {
      allow read, write: if true;
    }

    // Session forms
    match /sessionForms/{formId} {
      allow read, write: if true;
    }

    // Form tokens
    match /formTokens/{tokenId} {
      allow read, write: if true;
    }
  }
}
