<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ×™×œ×“×™× - ABA</title>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .admin-header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .back-link {
            display: inline-block;
            margin-top: 10px;
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .kids-list {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .kids-list h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .kid-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .kid-item:last-child {
            border-bottom: none;
        }

        .kid-info h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .kid-tasks {
            font-size: 0.9em;
            color: #666;
        }

        .kid-links {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .add-kid-form {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .add-kid-form h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #667eea;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-size: 1em;
        }

        .tasks-builder {
            margin-top: 20px;
        }

        .tasks-builder h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .task-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .task-input-row input {
            flex: 1;
            padding: 10px;
            border: 2px solid #eee;
            border-radius: 10px;
        }

        .task-input-row button {
            padding: 10px 15px;
            border: none;
            border-radius: 10px;
            background: #ff6b6b;
            color: white;
            cursor: pointer;
        }

        .emoji-display {
            width: 60px;
            height: 42px;
            text-align: center;
            font-size: 1.5em;
            border: 2px solid #eee;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: white;
            transition: all 0.3s ease;
        }

        .emoji-display:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        /* Emoji Picker Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #667eea;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .emoji-item {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            border: 2px solid #eee;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .emoji-item:hover {
            transform: scale(1.2);
            border-color: #667eea;
            background: #f0f0ff;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.5em;
            color: white;
        }

        @media (max-width: 600px) {
            .kid-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .kid-links {
                width: 100%;
            }

            .emoji-grid {
                grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="loadingState" class="loading">×˜×•×¢×Ÿ...</div>

    <div id="adminContainer" class="admin-container" style="display: none;">
        <div class="admin-header">
            <h1>ğŸ¯ × ×™×”×•×œ ×™×œ×“×™× ×•××©×™××•×ª ğŸ¯</h1>
            <a href="index.html" class="back-link">â† ×—×–×¨×” ×œ×œ×•×— ×¨××©×™</a>
        </div>

        <div class="kids-list">
            <h2>×¨×©×™××ª ×™×œ×“×™×</h2>
            <div id="kidsList"></div>
        </div>

        <div class="add-kid-form">
            <h2 id="formTitle">×”×•×¡×£ ×™×œ×“ ×—×“×©</h2>

            <div class="form-group">
                <label>×©× ×”×™×œ×“:</label>
                <input type="text" id="newKidName" placeholder="×”×›× ×¡ ×©×">
            </div>

            <div class="form-group">
                <label>×©× ×ª××•× ×” (×œ×“×•×’××”: lenny-small.png):</label>
                <input type="text" id="kidImageName" placeholder="×©× ×§×•×‘×¥ ×”×ª××•× ×”">
            </div>

            <div class="form-group">
                <label>×¡×›×•× ×›×¡×£ ($):</label>
                <input type="number" id="kidMoney" placeholder="0.00" step="0.01" min="0">
            </div>

            <div class="form-group">
                <label>×¤×¨×¡ ×™×•××™ ×‘×¢×‘×•×¨ ×¡×™×•× ×›×œ ×”××©×™××•×ª ($):</label>
                <input type="number" id="kidDailyReward" placeholder="0.50" step="0.01" min="0" value="0.50">
            </div>

            <div class="tasks-builder">
                <h3>××©×™××•×ª:</h3>
                <div id="tasksList"></div>
                <button class="btn btn-secondary" onclick="addTaskRow()">+ ×”×•×¡×£ ××©×™××”</button>
            </div>

            <button class="btn btn-primary" id="saveButton" onclick="saveKid()" style="margin-top: 20px; width: 100%;">×©××•×¨ ×™×œ×“</button>
            <button class="btn btn-secondary" id="cancelButton" onclick="cancelEdit()" style="margin-top: 10px; width: 100%; display: none;">×‘×™×˜×•×œ</button>
        </div>
    </div>

    <!-- Emoji Picker Modal -->
    <div id="emojiModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>×‘×—×¨ ××™×™×§×•×Ÿ</h3>
                <button class="close-btn" onclick="closeEmojiPicker()">Ã—</button>
            </div>
            <div class="emoji-grid" id="emojiGrid"></div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHE7FKHJ92rXXfz_3hLX8e9s8lC9g9g9o",
            authDomain: "aba-ai-d74f5.firebaseapp.com",
            projectId: "aba-ai-d74f5",
            storageBucket: "aba-ai-d74f5.firebasestorage.app",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Emoji categories
        const emojis = [
            // Faces & Emotions
            'ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜˜',
            'ğŸ˜—', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ¤¨', 'ğŸ§', 'ğŸ¤“', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³', 'ğŸ˜', 'ğŸ˜’',

            // Activities & Objects
            'ğŸ¯', 'ğŸ®', 'ğŸ²', 'ğŸ­', 'ğŸ¨', 'ğŸ¬', 'ğŸª', 'ğŸ°', 'ğŸ¸', 'ğŸ¹', 'ğŸº', 'ğŸ»', 'ğŸ¥', 'ğŸ¤', 'ğŸ§', 'ğŸ¼',
            'âš½', 'ğŸ€', 'ğŸˆ', 'âš¾', 'ğŸ¥', 'ğŸ¾', 'ğŸ', 'ğŸ‰', 'ğŸ¥', 'ğŸ±', 'ğŸª€', 'ğŸ“', 'ğŸ¸', 'ğŸ’', 'ğŸ‘', 'ğŸ¥',

            // Nature
            'ğŸŒ¸', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ·', 'ğŸŒ¹', 'ğŸ¥€', 'ğŸŒ¼', 'ğŸŒ±', 'ğŸŒ²', 'ğŸŒ³', 'ğŸŒ´', 'ğŸŒµ', 'ğŸŒ¾', 'ğŸŒ¿', 'â˜˜ï¸', 'ğŸ€',
            'â­', 'ğŸŒŸ', 'âœ¨', 'ğŸ’«', 'âš¡', 'ğŸ”¥', 'ğŸ’¥', 'â˜€ï¸', 'ğŸŒ™', 'â­', 'ğŸŒˆ', 'â˜ï¸', 'â›…', 'ğŸŒ¤ï¸', 'â›ˆï¸', 'ğŸŒ©ï¸',

            // Animals
            'ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸµ', 'ğŸ”',
            'ğŸ§', 'ğŸ¦', 'ğŸ¤', 'ğŸ¦†', 'ğŸ¦…', 'ğŸ¦‰', 'ğŸ¦‡', 'ğŸº', 'ğŸ—', 'ğŸ´', 'ğŸ¦„', 'ğŸ', 'ğŸ›', 'ğŸ¦‹', 'ğŸŒ', 'ğŸ',

            // Food
            'ğŸ', 'ğŸ', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ‰', 'ğŸ‡', 'ğŸ“', 'ğŸˆ', 'ğŸ’', 'ğŸ‘', 'ğŸ¥­', 'ğŸ', 'ğŸ¥¥', 'ğŸ¥', 'ğŸ…',
            'ğŸ¥‘', 'ğŸ†', 'ğŸ¥”', 'ğŸ¥•', 'ğŸŒ½', 'ğŸŒ¶ï¸', 'ğŸ¥’', 'ğŸ¥¬', 'ğŸ¥¦', 'ğŸ§„', 'ğŸ§…', 'ğŸ„', 'ğŸ¥œ', 'ğŸŒ°', 'ğŸ', 'ğŸ¥',

            // Activities & Daily Tasks
            'ğŸª¥', 'ğŸ§¸', 'ğŸ‘•', 'ğŸ’§', 'ğŸ¥ª', 'ğŸ‘Ÿ', 'ğŸ§¼', 'ğŸš¿', 'ğŸš½', 'ğŸ¥¤', 'ğŸ›', 'ğŸ§´', 'ğŸ§»', 'ğŸ§¹', 'ğŸ§º', 'ğŸ§½',
            'â°', 'â±ï¸', 'âŒš', 'ğŸ“š', 'ğŸ“–', 'âœï¸', 'âœ’ï¸', 'ğŸ–Šï¸', 'ğŸ–ï¸', 'ğŸ“', 'ğŸ’', 'ğŸ“', 'ğŸ“', 'ğŸ“', 'ğŸ“Œ', 'ğŸ“',

            // Electronics & Screens
            'ğŸ“±', 'ğŸ’»', 'ğŸ–¥ï¸', 'âŒ¨ï¸', 'ğŸ–±ï¸', 'ğŸ–¨ï¸', 'ğŸ“º', 'ğŸ“·', 'ğŸ“¹', 'ğŸ¥', 'ğŸ“', 'â˜ï¸', 'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ”‹', 'ğŸ”Œ',

            // Symbols
            'ğŸ’°', 'ğŸ’µ', 'ğŸ’´', 'ğŸ’¶', 'ğŸ’·', 'ğŸª™', 'ğŸ’³', 'ğŸ†', 'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ–ï¸', 'ğŸ…', 'ğŸ—ï¸', 'âœ…', 'â˜‘ï¸',
            'â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ–¤', 'ğŸ¤', 'ğŸ¤', 'ğŸ’–', 'ğŸ’', 'ğŸ’—', 'ğŸ’“', 'ğŸ’', 'ğŸ’•', 'ğŸ’Œ'
        ];

        let currentTaskRow = null;
        let editingKidId = null;

        // Initialize
        window.onload = async function() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';

            await loadKidsList();
            addTaskRow(); // Add first task row
            initEmojiGrid();
        };

        // Initialize emoji grid
        function initEmojiGrid() {
            const emojiGrid = document.getElementById('emojiGrid');
            emojis.forEach(emoji => {
                const emojiItem = document.createElement('div');
                emojiItem.className = 'emoji-item';
                emojiItem.textContent = emoji;
                emojiItem.onclick = () => selectEmoji(emoji);
                emojiGrid.appendChild(emojiItem);
            });
        }

        // Load kids list
        async function loadKidsList() {
            const snapshot = await db.collection('kids').get();
            const kidsList = document.getElementById('kidsList');
            kidsList.innerHTML = '';

            if (snapshot.empty) {
                kidsList.innerHTML = '<p style="text-align: center; color: #666;">××™×Ÿ ×™×œ×“×™× ×‘××¢×¨×›×ª</p>';
                return;
            }

            snapshot.forEach(doc => {
                const kid = doc.data();
                const kidDiv = document.createElement('div');
                kidDiv.className = 'kid-item';
                kidDiv.innerHTML = `
                    <div class="kid-info">
                        <h3>${kid.name}</h3>
                        <div class="kid-tasks">${kid.tasks.length} ××©×™××•×ª | $${(kid.totalMoney || 0).toFixed(2)}</div>
                    </div>
                    <div class="kid-links">
                        <a href="index.html?kid=${doc.id}" class="btn btn-primary">×œ×•×— ×™×œ×“</a>
                        <a href="index.html?kid=${doc.id}&mode=parent" class="btn btn-secondary">×œ×•×— ×”×•×¨×”</a>
                        <button class="btn btn-primary" onclick="editKid('${doc.id}')">×¢×¨×•×š</button>
                    </div>
                `;
                kidsList.appendChild(kidDiv);
            });
        }

        // Task row management
        let taskCounter = 0;
        function addTaskRow() {
            const tasksList = document.getElementById('tasksList');
            const taskRow = document.createElement('div');
            taskRow.className = 'task-input-row';
            taskRow.id = `task-${taskCounter}`;

            taskRow.innerHTML = `
                <div class="emoji-display" onclick="openEmojiPicker('task-${taskCounter}')" data-task-id="task-${taskCounter}">ğŸ¯</div>
                <input type="text" placeholder="×ª×™××•×¨ ×”××©×™××”" data-type="title">
                <button onclick="removeTaskRow('task-${taskCounter}')">ğŸ—‘ï¸</button>
            `;

            tasksList.appendChild(taskRow);
            taskCounter++;
        }

        function removeTaskRow(taskId) {
            document.getElementById(taskId).remove();
        }

        // Emoji picker
        function openEmojiPicker(taskId) {
            currentTaskRow = taskId;
            document.getElementById('emojiModal').classList.add('active');
        }

        function closeEmojiPicker() {
            document.getElementById('emojiModal').classList.remove('active');
            currentTaskRow = null;
        }

        function selectEmoji(emoji) {
            if (currentTaskRow) {
                const taskRow = document.getElementById(currentTaskRow);
                const emojiDisplay = taskRow.querySelector('.emoji-display');
                emojiDisplay.textContent = emoji;
            }
            closeEmojiPicker();
        }

        // Close modal when clicking outside
        document.getElementById('emojiModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEmojiPicker();
            }
        });

        // Edit existing kid
        async function editKid(kidId) {
            try {
                const doc = await db.collection('kids').doc(kidId).get();
                if (!doc.exists) {
                    alert('×™×œ×“ ×œ× × ××¦×');
                    return;
                }

                const kidData = doc.data();
                editingKidId = kidId;

                // Update form title and button
                document.getElementById('formTitle').textContent = `×¢×¨×•×š ×™×œ×“: ${kidData.name}`;
                document.getElementById('saveButton').textContent = '×©××•×¨ ×©×™× ×•×™×™×';
                document.getElementById('cancelButton').style.display = 'block';

                // Fill form with existing data
                document.getElementById('newKidName').value = kidData.name;
                document.getElementById('kidImageName').value = kidData.imageName || '';
                document.getElementById('kidMoney').value = kidData.totalMoney || 0;
                document.getElementById('kidDailyReward').value = kidData.dailyReward || 0.5;

                // Clear and populate tasks
                document.getElementById('tasksList').innerHTML = '';
                taskCounter = 0;

                if (kidData.tasks && kidData.tasks.length > 0) {
                    kidData.tasks.forEach(task => {
                        addTaskRow();
                        const lastRow = document.getElementById(`task-${taskCounter - 1}`);
                        lastRow.querySelector('.emoji-display').textContent = task.icon;
                        lastRow.querySelector('[data-type="title"]').value = task.title;
                    });
                } else {
                    addTaskRow();
                }

                // Scroll to form
                document.querySelector('.add-kid-form').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Error loading kid for edit:', error);
                alert('×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×”×™×œ×“');
            }
        }

        // Cancel edit
        function cancelEdit() {
            editingKidId = null;
            document.getElementById('formTitle').textContent = '×”×•×¡×£ ×™×œ×“ ×—×“×©';
            document.getElementById('saveButton').textContent = '×©××•×¨ ×™×œ×“';
            document.getElementById('cancelButton').style.display = 'none';
            document.getElementById('newKidName').value = '';
            document.getElementById('kidImageName').value = '';
            document.getElementById('kidMoney').value = '';
            document.getElementById('kidDailyReward').value = '0.50';
            document.getElementById('tasksList').innerHTML = '';
            addTaskRow();
        }

        // Save kid (create or update)
        async function saveKid() {
            const name = document.getElementById('newKidName').value.trim();
            const imageName = document.getElementById('kidImageName').value.trim();
            const money = parseFloat(document.getElementById('kidMoney').value) || 0;
            const dailyReward = parseFloat(document.getElementById('kidDailyReward').value) || 0.5;

            if (!name) {
                alert('× × ×œ×”×›× ×™×¡ ×©× ×™×œ×“');
                return;
            }

            const taskRows = document.querySelectorAll('#tasksList .task-input-row');
            const tasks = [];
            let taskId = 1;

            taskRows.forEach(row => {
                const icon = row.querySelector('.emoji-display').textContent.trim();
                const title = row.querySelector('[data-type="title"]').value.trim();
                if (icon && title) {
                    tasks.push({ id: taskId++, icon, title });
                }
            });

            if (tasks.length === 0) {
                alert('× × ×œ×”×•×¡×™×£ ×œ×¤×—×•×ª ××©×™××” ××—×ª');
                return;
            }

            try {
                const kidId = editingKidId || name.toLowerCase().replace(/\s+/g, '-');

                if (editingKidId) {
                    // Update existing kid
                    await db.collection('kids').doc(kidId).update({
                        name: name,
                        imageName: imageName || '',
                        tasks: tasks,
                        totalMoney: money,
                        dailyReward: dailyReward
                    });
                    alert('×”×©×™× ×•×™×™× × ×©××¨×• ×‘×”×¦×œ×—×”!');
                } else {
                    // Create new kid
                    await db.collection('kids').doc(kidId).set({
                        name: name,
                        imageName: imageName || '',
                        tasks: tasks,
                        completedTasks: [],
                        totalMoney: money,
                        dailyReward: dailyReward,
                        todayRewardGiven: false,
                        lastResetDate: new Date().toDateString(),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert('×”×™×œ×“ × ×•×¡×£ ×‘×”×¦×œ×—×”!');
                }

                cancelEdit();
                await loadKidsList();
            } catch (error) {
                console.error('Error saving kid:', error);
                alert('×©×’×™××” ×‘×©××™×¨×”: ' + error.message);
            }
        }
    </script>
</body>
</html>
