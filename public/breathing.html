<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>◊†◊©◊ô◊û◊ï◊™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(180deg, #e0f7fa 0%, #b2ebf2 30%, #80deea 70%, #4dd0e1 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
            touch-action: none;
        }

        .breathing-scene {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Sun in corner */
        .sun {
            position: absolute;
            top: -30px;
            right: -30px;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, #fff9c4 0%, #ffee58 40%, #ffd54f 100%);
            border-radius: 50%;
            box-shadow: 0 0 60px rgba(255, 235, 59, 0.6), 0 0 100px rgba(255, 235, 59, 0.3);
        }

        /* Animated character */
        .character {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: opacity 0.5s ease;
        }

        /* Face/head */
        .face {
            width: 130px;
            height: 130px;
            background: linear-gradient(160deg, #ffe4c4 0%, #ffcba4 50%, #f5b98a 100%);
            border-radius: 50%;
            position: relative;
            z-index: 2;
            box-shadow:
                0 8px 25px rgba(0,0,0,0.12),
                inset 0 -5px 15px rgba(0,0,0,0.05),
                inset 0 5px 15px rgba(255,255,255,0.3);
        }

        /* Hair */
        .hair {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 110px;
            height: 50px;
            background: linear-gradient(180deg, #5d4037 0%, #4e342e 100%);
            border-radius: 60px 60px 0 0;
            z-index: 3;
        }

        .hair::before {
            content: '';
            position: absolute;
            top: 30px;
            left: -15px;
            width: 30px;
            height: 40px;
            background: linear-gradient(180deg, #5d4037 0%, #4e342e 100%);
            border-radius: 50%;
        }

        .hair::after {
            content: '';
            position: absolute;
            top: 30px;
            right: -15px;
            width: 30px;
            height: 40px;
            background: linear-gradient(180deg, #5d4037 0%, #4e342e 100%);
            border-radius: 50%;
        }

        /* Eyes */
        .eyes {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 35px;
        }

        .eye {
            width: 14px;
            height: 14px;
            background: linear-gradient(180deg, #2c2c2c 0%, #1a1a1a 100%);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .eye::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 3px;
            width: 5px;
            height: 5px;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
        }

        .breathing .eye {
            animation: blink 5s infinite;
        }

        @keyframes blink {
            0%, 42%, 48%, 100% {
                height: 14px;
                margin-top: 0;
                border-radius: 50%;
            }
            45% {
                height: 2px;
                margin-top: 6px;
                border-radius: 2px;
            }
        }

        /* Peaceful smile */
        .mouth {
            position: absolute;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%);
            width: 35px;
            height: 18px;
            border: 4px solid #d4856a;
            border-top: none;
            border-radius: 0 0 35px 35px;
            background: transparent;
            transition: all 0.6s ease;
        }

        /* Inhale mouth - open wide like smelling a flower */
        .mouth.inhale {
            width: 22px;
            height: 22px;
            border: 4px solid #d4856a;
            border-top: 4px solid #d4856a;
            border-radius: 50%;
            background: #c96b55;
            bottom: 32px;
            animation: inhalemouth 4s ease-in-out;
        }

        @keyframes inhalemouth {
            0% { width: 22px; height: 16px; }
            50% { width: 26px; height: 26px; }
            100% { width: 22px; height: 22px; }
        }

        /* Exhale mouth - pursed lips like blowing a candle */
        .mouth.exhale {
            width: 14px;
            height: 14px;
            border: 4px solid #d4856a;
            border-top: 4px solid #d4856a;
            border-radius: 50%;
            background: #c96b55;
            bottom: 35px;
            animation: exhalemouth 4s ease-in-out;
        }

        @keyframes exhalemouth {
            0% { width: 14px; height: 14px; }
            30% { width: 12px; height: 16px; }
            70% { width: 10px; height: 14px; }
            100% { width: 14px; height: 14px; }
        }

        /* Cheeks (blush) */
        .cheek {
            position: absolute;
            width: 25px;
            height: 15px;
            background: radial-gradient(ellipse, rgba(255, 138, 138, 0.6) 0%, transparent 70%);
            border-radius: 50%;
            top: 65px;
        }

        .cheek.left { left: 12px; }
        .cheek.right { right: 12px; }

        /* Body/belly that breathes */
        .body {
            width: 150px;
            height: 110px;
            background: linear-gradient(160deg, #81d4fa 0%, #4fc3f7 40%, #29b6f6 100%);
            border-radius: 75px 75px 55px 55px;
            margin-top: -25px;
            position: relative;
            z-index: 1;
            box-shadow:
                0 15px 35px rgba(0,0,0,0.12),
                inset 0 -8px 20px rgba(0,0,0,0.08),
                inset 0 8px 20px rgba(255,255,255,0.25);
            transition: transform 4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .body.inhale {
            transform: scale(1.22, 1.32);
        }

        .body.exhale {
            transform: scale(1, 1);
        }

        /* Shirt collar */
        .collar {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 20px;
            background: linear-gradient(180deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 0 0 30px 30px;
        }

        /* Arms */
        .arm {
            position: absolute;
            width: 28px;
            height: 65px;
            background: linear-gradient(160deg, #81d4fa 0%, #4fc3f7 40%, #29b6f6 100%);
            border-radius: 15px;
            top: 15px;
            z-index: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .arm.left {
            left: -18px;
            transform: rotate(18deg);
        }

        .arm.right {
            right: -18px;
            transform: rotate(-18deg);
        }

        /* Hand */
        .hand {
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 22px;
            height: 22px;
            background: linear-gradient(160deg, #ffe4c4 0%, #ffcba4 100%);
            border-radius: 50%;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        /* Belly decoration */
        .belly-star {
            position: absolute;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
            transition: all 0.3s ease;
        }

        /* Breathing objects - flower and candle */
        .breathing-object {
            position: absolute;
            font-size: 80px;
            transition: opacity 0.8s ease, transform 0.8s ease;
            opacity: 0;
            pointer-events: none;
            z-index: 50;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.15));
        }

        .breathing-object.flower {
            bottom: 40%;
            left: 50%;
            transform: translateX(-50%) scale(0.7);
        }

        .breathing-object.flower.active {
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }

        .breathing-object.candle {
            bottom: 40%;
            left: 50%;
            transform: translateX(-50%) scale(0.7);
        }

        .breathing-object.candle.active {
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }

        /* Instruction text */
        .breathing-instruction {
            position: absolute;
            bottom: 24%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28px;
            font-weight: bold;
            color: #2e7d32;
            text-shadow: 0 2px 4px rgba(255,255,255,0.8);
            opacity: 0;
            transition: opacity 0.6s ease;
            z-index: 50;
            white-space: nowrap;
        }

        .breathing-instruction.active {
            opacity: 1;
        }

        .breathing-instruction.exhale-text {
            color: #e65100;
        }

        /* Candle flame flicker when active */
        .candle.active {
            animation: flicker 0.3s infinite alternate;
        }

        /* Candle blown out - dimmed, no flame effect */
        .breathing-object.candle.blown-out {
            animation: none;
            transform: translateX(-50%) scale(1);
            opacity: 0.7;
            filter: brightness(0.5) grayscale(0.6);
            transition: filter 0.5s ease, opacity 0.5s ease;
        }

        @keyframes flicker {
            0% { transform: translateX(-50%) scale(1) rotate(-1deg); }
            100% { transform: translateX(-50%) scale(1.02) rotate(1deg); }
        }

        /* Smoke wisps from blown-out candle */
        .smoke-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(180, 180, 180, 0.5);
            border-radius: 50%;
            pointer-events: none;
            z-index: 52;
            animation: smokeRise 1.8s ease-out forwards;
        }

        @keyframes smokeRise {
            0% {
                opacity: 0.6;
                transform: translate(0, 0) scale(1);
            }
            50% {
                opacity: 0.4;
                transform: translate(var(--smoke-x, 8px), -30px) scale(1.5);
            }
            100% {
                opacity: 0;
                transform: translate(var(--smoke-x, 12px), -60px) scale(2);
            }
        }

        /* Flower gentle sway when active */
        .flower.active {
            animation: sway 2s infinite ease-in-out;
        }

        @keyframes sway {
            0%, 100% { transform: translateX(-50%) scale(1) rotate(-2deg); }
            50% { transform: translateX(-50%) scale(1) rotate(2deg); }
        }

        /* Blow effect - small circles floating away */
        .blow-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            z-index: 51;
            animation: blowAway 2s ease-out forwards;
        }

        @keyframes blowAway {
            0% {
                opacity: 0.8;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--blow-x, 60px), var(--blow-y, -80px)) scale(0.3);
            }
        }

        /* Smell effect - wavy lines rising from flower */
        .smell-particle {
            position: absolute;
            font-size: 20px;
            pointer-events: none;
            z-index: 51;
            opacity: 0;
            animation: smellRise 2.5s ease-out forwards;
        }

        @keyframes smellRise {
            0% {
                opacity: 0;
                transform: translate(0, 0) scale(0.5);
            }
            30% {
                opacity: 0.7;
            }
            100% {
                opacity: 0;
                transform: translate(var(--smell-x, 10px), -80px) scale(1);
            }
        }

        /* Floating clouds background */
        .cloud {
            position: absolute;
            background: rgba(255,255,255,0.9);
            border-radius: 100px;
            animation: float 25s infinite linear;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }

        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
        }

        .cloud1 {
            width: 110px;
            height: 45px;
            top: 12%;
            left: -110px;
            animation-delay: 0s;
        }

        .cloud1::before {
            width: 55px;
            height: 55px;
            top: -28px;
            left: 18px;
        }

        .cloud1::after {
            width: 40px;
            height: 40px;
            top: -18px;
            left: 55px;
        }

        .cloud2 {
            width: 90px;
            height: 36px;
            top: 28%;
            left: -90px;
            animation-delay: -8s;
            animation-duration: 30s;
        }

        .cloud2::before {
            width: 45px;
            height: 45px;
            top: -22px;
            left: 12px;
        }

        .cloud2::after {
            width: 32px;
            height: 32px;
            top: -14px;
            left: 45px;
        }

        .cloud3 {
            width: 130px;
            height: 52px;
            top: 65%;
            left: -130px;
            animation-delay: -16s;
            animation-duration: 35s;
        }

        .cloud3::before {
            width: 65px;
            height: 65px;
            top: -32px;
            left: 22px;
        }

        .cloud3::after {
            width: 48px;
            height: 48px;
            top: -20px;
            left: 70px;
        }

        @keyframes float {
            from { transform: translateX(0); }
            to { transform: translateX(calc(100vw + 150px)); }
        }

        /* Breathing indicator - subtle glow */
        .glow {
            position: absolute;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(129, 212, 250, 0.5) 0%, rgba(129, 212, 250, 0.2) 40%, transparent 70%);
            z-index: 0;
            transition: transform 4s cubic-bezier(0.4, 0, 0.2, 1), opacity 4s;
        }

        .glow.inhale {
            transform: scale(1.9);
            opacity: 1;
        }

        .glow.exhale {
            transform: scale(1);
            opacity: 0.4;
        }

        /* Ground/grass */
        .ground {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(180deg, #a5d6a7 0%, #81c784 50%, #66bb6a 100%);
            border-radius: 100% 100% 0 0;
        }

        .ground::before {
            content: '';
            position: absolute;
            bottom: 20px;
            left: 20%;
            width: 60px;
            height: 30px;
            background: radial-gradient(ellipse, rgba(255,255,255,0.3) 0%, transparent 70%);
            border-radius: 50%;
        }

        /* Play button overlay */
        .play-btn {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ffffff 0%, #f5f5f5 100%);
            border: none;
            font-size: 42px;
            cursor: pointer;
            box-shadow:
                0 8px 30px rgba(0,0,0,0.15),
                0 4px 10px rgba(0,0,0,0.1),
                inset 0 2px 5px rgba(255,255,255,0.8);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            animation: pulse 2.5s infinite ease-in-out;
        }

        .play-btn:hover {
            transform: translateX(-50%) scale(1.05);
        }

        .play-btn:active {
            transform: translateX(-50%) scale(0.95);
            box-shadow:
                0 4px 15px rgba(0,0,0,0.15),
                0 2px 5px rgba(0,0,0,0.1);
        }

        .play-btn.hidden {
            opacity: 0;
            pointer-events: none;
            animation: none;
            transform: translateX(-50%) scale(0.8);
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow:
                    0 8px 30px rgba(0,0,0,0.15),
                    0 4px 10px rgba(0,0,0,0.1),
                    0 0 0 0 rgba(129, 212, 250, 0.4);
            }
            50% {
                box-shadow:
                    0 8px 30px rgba(0,0,0,0.15),
                    0 4px 10px rgba(0,0,0,0.1),
                    0 0 0 15px rgba(129, 212, 250, 0);
            }
        }

        /* Sound indicator */
        .sound-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ffffff 0%, #f5f5f5 100%);
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .sound-btn:active {
            transform: scale(0.95);
        }

        /* Butterflies */
        .butterfly {
            position: absolute;
            font-size: 22px;
            opacity: 0;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
        }

        .breathing .butterfly {
            animation: flutter 8s infinite ease-in-out;
        }

        .butterfly:nth-child(1) {
            top: 20%;
            left: 15%;
            animation-delay: 0s;
        }
        .butterfly:nth-child(2) {
            top: 35%;
            right: 12%;
            animation-delay: 2s;
        }
        .butterfly:nth-child(3) {
            top: 55%;
            left: 8%;
            animation-delay: 4s;
        }

        @keyframes flutter {
            0%, 100% {
                opacity: 0;
                transform: translate(0, 0) rotate(-5deg);
            }
            10% {
                opacity: 0.9;
            }
            50% {
                opacity: 0.9;
                transform: translate(30px, -20px) rotate(5deg);
            }
            90% {
                opacity: 0.9;
            }
        }

        /* Paused state */
        .character.paused {
            opacity: 0.85;
        }

        .character.paused .belly-star {
            animation: gentlePulse 2s infinite ease-in-out;
        }

        @keyframes gentlePulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
        }
    </style>
</head>
<body>
    <div class="breathing-scene">
        <!-- Sun -->
        <div class="sun"></div>

        <!-- Floating clouds -->
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>
        <div class="cloud cloud3"></div>

        <!-- Butterflies -->
        <div class="butterflies" id="butterflies">
            <div class="butterfly">ü¶ã</div>
            <div class="butterfly">ü¶ã</div>
            <div class="butterfly">ü¶ã</div>
        </div>

        <!-- Ground -->
        <div class="ground"></div>

        <!-- Breathing objects -->
        <div class="breathing-object flower" id="flower">üå∏</div>
        <div class="breathing-object candle" id="candle">üïØÔ∏è</div>
        <div class="breathing-instruction" id="instruction"></div>

        <!-- Glow effect -->
        <div class="glow" id="glow"></div>

        <!-- Breathing character -->
        <div class="character paused" id="character" onclick="toggleBreathing()">
            <div class="face">
                <div class="hair"></div>
                <div class="eyes">
                    <div class="eye"></div>
                    <div class="eye"></div>
                </div>
                <div class="cheek left"></div>
                <div class="cheek right"></div>
                <div class="mouth"></div>
            </div>
            <div class="body" id="body">
                <div class="collar"></div>
                <div class="arm left"><div class="hand"></div></div>
                <div class="arm right"><div class="hand"></div></div>
                <div class="belly-star" id="bellyStar">‚≠ê</div>
            </div>
        </div>

        <!-- Big play button -->
        <button class="play-btn" id="playBtn" onclick="toggleBreathing()">‚ñ∂Ô∏è</button>
    </div>

    <!-- Minimal controls -->
    <button class="sound-btn" id="soundBtn" onclick="event.stopPropagation(); toggleSound();">üîä</button>

    <script>
        // Simple state - starts paused
        let isBreathing = false;
        let soundEnabled = true;
        let audioContext = null;

        const body = document.getElementById('body');
        const glow = document.getElementById('glow');
        const soundBtn = document.getElementById('soundBtn');
        const playBtn = document.getElementById('playBtn');
        const character = document.getElementById('character');
        const butterflies = document.getElementById('butterflies');
        const flower = document.getElementById('flower');
        const candle = document.getElementById('candle');
        const instruction = document.getElementById('instruction');
        const mouth = document.querySelector('.mouth');
        let candleBlowTimeout = null;

        // Breathing timing
        const INHALE_TIME = 4000;
        const EXHALE_TIME = 4000;

        // Initialize audio context on first interaction
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Play gentle chime
        function playChime(frequency, duration) {
            if (!soundEnabled || !audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'sine';
            oscillator.frequency.value = frequency;

            const now = audioContext.currentTime;
            gainNode.gain.setValueAtTime(0, now);
            gainNode.gain.linearRampToValueAtTime(0.12, now + 0.15);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);

            oscillator.start(now);
            oscillator.stop(now + duration);
        }

        // Show smell particles rising from flower
        function showSmellParticles() {
            const scene = document.querySelector('.breathing-scene');
            const flowerRect = flower.getBoundingClientRect();
            const centerX = flowerRect.left + flowerRect.width / 2;
            const centerY = flowerRect.top;

            for (let i = 0; i < 4; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'smell-particle';
                    particle.textContent = '~';
                    particle.style.left = (centerX + (Math.random() - 0.5) * 40) + 'px';
                    particle.style.top = (centerY - 10) + 'px';
                    particle.style.setProperty('--smell-x', ((Math.random() - 0.5) * 30) + 'px');
                    particle.style.color = 'rgba(255, 182, 193, 0.7)';
                    scene.appendChild(particle);
                    setTimeout(() => particle.remove(), 2500);
                }, i * 400);
            }
        }

        // Show blow particles from candle
        function showBlowParticles() {
            const scene = document.querySelector('.breathing-scene');
            const candleRect = candle.getBoundingClientRect();
            const centerX = candleRect.left + candleRect.width / 2;
            const centerY = candleRect.top;

            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'blow-particle';
                    particle.style.left = (centerX + (Math.random() - 0.5) * 20) + 'px';
                    particle.style.top = (centerY + 5) + 'px';
                    particle.style.setProperty('--blow-x', ((Math.random() - 0.5) * 80) + 'px');
                    particle.style.setProperty('--blow-y', (-50 - Math.random() * 60) + 'px');
                    scene.appendChild(particle);
                    setTimeout(() => particle.remove(), 2000);
                }, i * 300);
            }
        }

        // Show smoke particles when candle is blown out
        function showSmokeParticles() {
            const scene = document.querySelector('.breathing-scene');
            const candleRect = candle.getBoundingClientRect();
            const centerX = candleRect.left + candleRect.width / 2;
            const centerY = candleRect.top + 5;

            for (let i = 0; i < 4; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'smoke-particle';
                    particle.style.left = (centerX + (Math.random() - 0.5) * 15) + 'px';
                    particle.style.top = centerY + 'px';
                    particle.style.setProperty('--smoke-x', ((Math.random() - 0.5) * 20) + 'px');
                    scene.appendChild(particle);
                    setTimeout(() => particle.remove(), 1800);
                }, i * 200);
            }
        }

        // Show/hide breathing objects
        function showFlower() {
            // Reset candle state
            if (candleBlowTimeout) {
                clearTimeout(candleBlowTimeout);
                candleBlowTimeout = null;
            }
            candle.classList.remove('active', 'blown-out');
            flower.classList.add('active');
            instruction.textContent = 'üå∏ ◊™◊®◊ô◊ó ◊ê◊™ ◊î◊§◊®◊ó';
            instruction.className = 'breathing-instruction active';
            // Set mouth to inhale (open, smelling)
            mouth.className = 'mouth inhale';
            showSmellParticles();
        }

        function showCandle() {
            flower.classList.remove('active');
            candle.classList.remove('blown-out');
            candle.classList.add('active');
            instruction.textContent = 'üïØÔ∏è ◊™◊†◊©◊ï◊£ ◊¢◊ú ◊î◊†◊®';
            instruction.className = 'breathing-instruction exhale-text active';
            // Set mouth to exhale (pursed, blowing)
            mouth.className = 'mouth exhale';
            showBlowParticles();

            // After 1.5 seconds, blow out the candle
            candleBlowTimeout = setTimeout(() => {
                candle.classList.remove('active');
                candle.classList.add('blown-out');
                instruction.textContent = 'üí® ◊õ◊ô◊ë◊ô◊™ ◊ê◊™ ◊î◊†◊®!';
                showSmokeParticles();
            }, 1500);
        }

        function hideBreathingObjects() {
            if (candleBlowTimeout) {
                clearTimeout(candleBlowTimeout);
                candleBlowTimeout = null;
            }
            flower.classList.remove('active');
            candle.classList.remove('active', 'blown-out');
            instruction.classList.remove('active');
            // Reset mouth to default smile
            mouth.className = 'mouth';
        }

        // Breathing animation loop
        async function breathe() {
            while (true) {
                if (isBreathing) {
                    // Inhale - smell the flower
                    body.className = 'body inhale';
                    glow.className = 'glow inhale';
                    showFlower();
                    playChime(523, 0.8); // C5
                    await wait(INHALE_TIME);

                    if (!isBreathing) continue;

                    // Exhale - blow the candle
                    body.className = 'body exhale';
                    glow.className = 'glow exhale';
                    showCandle();
                    playChime(392, 0.8); // G4
                    await wait(EXHALE_TIME);
                } else {
                    await wait(100);
                }
            }
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Toggle breathing on tap
        function toggleBreathing() {
            initAudio();
            isBreathing = !isBreathing;

            if (isBreathing) {
                // Start breathing
                playBtn.classList.add('hidden');
                character.classList.remove('paused');
                character.classList.add('breathing');
                butterflies.classList.add('breathing');
                playChime(659, 0.4); // E5
            } else {
                // Pause breathing
                playBtn.classList.remove('hidden');
                playBtn.textContent = '‚ñ∂Ô∏è';
                character.classList.add('paused');
                character.classList.remove('breathing');
                butterflies.classList.remove('breathing');
                body.className = 'body';
                glow.className = 'glow';
                hideBreathingObjects();
            }
        }

        // Toggle sound
        function toggleSound() {
            initAudio();
            soundEnabled = !soundEnabled;
            soundBtn.textContent = soundEnabled ? 'üîä' : 'üîá';
        }

        // Prevent scrolling
        document.body.addEventListener('touchmove', e => e.preventDefault(), { passive: false });

        // Start breathing loop (waits for user to press play)
        breathe();
    </script>
</body>
</html>
